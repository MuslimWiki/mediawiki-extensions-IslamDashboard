# Internationalization (i18n) and Localization (l10n)

This document explains how internationalization (i18n) and localization (l10n) are implemented in the IslamDashboard extension.

## Message Files

All user-visible strings should be defined in message files located in the `i18n/` directory. The main message file is `i18n/en.json` for English.

### Message File Structure

```json
{
    "@metadata": {
        "authors": ["Your Name"],
        "last-updated": "2025-07-13",
        "message-documentation": "qqq"
    },
    "islamdashboard-hello": "Hello",
    "islamdashboard-welcome": "Welcome to IslamDashboard, $1!"
}
```

## Using Messages in PHP

Use the `wfMessage()` function to retrieve messages in PHP:

```php
// Simple message
$text = wfMessage( 'islamdashboard-hello' )->text();

// Message with parameters
$welcomeText = wfMessage( 'islamdashboard-welcome', $username )->text();

// Parse wikitext in messages
$html = wfMessage( 'islamdashboard-some-wikitext' )->parse();
```

## Using Messages in JavaScript

In JavaScript, use the `mw.message()` function:

```javascript
// Simple message
const hello = mw.message( 'islamdashboard-hello' ).text();

// Message with parameters
const welcome = mw.message( 'islamdashboard-welcome', username ).text();

// HTML message
const html = mw.message( 'islamdashboard-html-message' ).parse();
```

## Adding New Messages

1. Add the new message to `i18n/en.json`
2. Add documentation in the `qqq.json` file:
   ```json
   {
       "@metadata": {
           "authors": ["Your Name"]
       },
       "islamdashboard-new-message": "Documentation for the new message"
   }
   ```
3. Run the following command to update message files:
   ```bash
   php maintenance/mergeMessageFileList.php --extname=IslamDashboard
   ```

## Right-to-Left (RTL) Support

For RTL languages like Arabic, add the following to your LESS/CSS:

```less
/* Main content direction */
.mw-body {
    /* @noflip */
    direction: ltr;
}

/* RTL overrides */
.skin-vector-2022 .mw-body,
.skin-vector-2022 .mw-body-content {
    /* @noflip */
    direction: rtl;
}
```

## Date and Time Localization

Use MediaWiki's date formatting functions:

```php
// In PHP
$formattedDate = $wgLang->date( wfTimestampNow(), true );
$formattedTime = $wgLang->time( wfTimestampNow(), true );
$formattedDateTime = $wgLang->timeanddate( wfTimestampNow(), true );

// In JavaScript
const formattedDate = mw.language.convertNumber( new Date().toLocaleDateString( mw.config.get( 'wgUserLanguage' ) ) );
```

## Number and Currency Formatting

```php
// In PHP
$formattedNumber = $wgLang->formatNum( 1234.56 );
$formattedPrice = $wgLang->formatCurrency( 19.99, 'USD' );

// In JavaScript
const formattedNumber = mw.language.convertNumber( 1234.56 );
```

## Best Practices

1. **Never concatenate strings** that need translation
   ```php
   // Bad
   $message = wfMessage( 'islamdashboard-welcome' )->text() . ' ' . $username;
   
   // Good
   $message = wfMessage( 'islamdashboard-welcome', $username )->text();
   ```

2. **Use message parameters** for dynamic content
   ```json
   {
       "islamdashboard-user-greeting": "Hello, $1! You have $2 new notifications."
   }
   ```

3. **Keep messages complete** for better translation
   ```json
   // Bad
   {
       "islamdashboard-items": "items",
       "islamdashboard-showing": "Showing",
       "islamdashboard-of": "of"
   }
   
   // Good
   {
       "islamdashboard-showing-items": "Showing {{PLURAL:$1|item|items}} $1 of $2"
   }
   ```

4. **Handle plurals** using MediaWiki's plural system
   ```json
   {
       "islamdashboard-notification-count": "{{PLURAL:$1|You have one new notification|You have $1 new notifications}}"
   }
   ```

## Testing Localization

1. Test with different languages using the `uselang` URL parameter:
   ```
   /wiki/Special:IslamDashboard?uselang=ar
   ```

2. Check for message documentation in the Special:MessageDocs page

3. Verify RTL support by testing with RTL languages like Arabic or Hebrew

## Adding New Language Support

1. Create a new file in the `i18n/` directory (e.g., `i18n/ar.json` for Arabic)
2. Add the language code to the `extension.json` file:
   ```json
   "MessagesDirs": {
       "IslamDashboard": [
           "i18n"
       ]
   }
   ```
3. Update the `composer.json` file if needed for language-specific dependencies
4. Test the translation using the `uselang` parameter

## Translation Updates

To update translations from Translatewiki.net:

1. Install the `mediawiki/tools` package:
   ```bash
   composer require --dev mediawiki/tools-maintainers-check
   ```

2. Update translations:
   ```bash
   php maintenance/mergeMessageFileList.php --extname=IslamDashboard
   php maintenance/updateMessages.php IslamDashboard
   ```

## Common Issues

1. **Missing Messages**: If a message is missing, it will appear in angle brackets like `&lt;islamdashboard-missing-message>`
2. **Untranslated Messages**: New messages may not be immediately available in all languages
3. **Parameter Issues**: Make sure the number of parameters in the message matches the number of parameters passed
4. **HTML in Messages**: Always use `->parse()` instead of `->text()` when the message contains HTML

## Further Reading

- [MediaWiki Internationalization](https://www.mediawiki.org/wiki/Internationalisation)
- [Localisation for developers](https://www.mediawiki.org/wiki/Localisation_for_developers)
- [Writing systems support](https://www.mediawiki.org/wiki/Writing_systems_support)
- [Right-to-left (RTL) support](https://www.mediawiki.org/wiki/Right-to-left_(RTL)_support)
